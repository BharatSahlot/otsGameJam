!function(){"use strict";var t,e,i,r,o,s=function(){function t(t,e,i){this._gl=t;var r=this.compileShader(t.VERTEX_SHADER,e);if(null!=r){var o=this.compileShader(t.FRAGMENT_SHADER,i);null!=o&&(this._shaderProgram=t.createProgram(),t.attachShader(this._shaderProgram,r),t.attachShader(this._shaderProgram,o),t.linkProgram(this._shaderProgram),t.getProgramParameter(this._shaderProgram,t.LINK_STATUS)?this._uniformLocations=new Map:(console.log("An error occured while initializing shader program: "+t.getProgramInfoLog(this._shaderProgram)),t.deleteShader(r),t.deleteShader(o),t.deleteProgram(this._shaderProgram)))}}return t.prototype.use=function(){this._gl.useProgram(this._shaderProgram)},t.prototype.setMatrix3fv=function(t,e){this._uniformLocations.has(e)||(this._uniformLocations[e]=this._gl.getUniformLocation(this._shaderProgram,e)),this._gl.uniformMatrix3fv(this._uniformLocations[e],!1,t)},t.prototype.setUniform1i=function(t,e){this._uniformLocations.has(e)||(this._uniformLocations[e]=this._gl.getUniformLocation(this._shaderProgram,e)),this._gl.uniform1i(this._uniformLocations[e],t)},t.prototype.getAttribLocation=function(t){return this._gl.getAttribLocation(this._shaderProgram,t)},t.prototype.compileShader=function(t,e){console.log("Compiling shader\n"+e);var i=this._gl.createShader(t);return this._gl.shaderSource(i,e),this._gl.compileShader(i),this._gl.getShaderParameter(i,this._gl.COMPILE_STATUS)?i:(console.log("An error occured while compiling shader: "+this._gl.getShaderInfoLog(i)),this._gl.deleteShader(i),null)},t}(),a=function(t,e){return Float32Array.from([1/t,0,0,0,1/e,0,-1,1,1])},n=function(t,e){return Float32Array.from([1,0,0,0,1,0,t,e,1])},h=function(t){var e=Math.cos(t),i=Math.sin(t);return Float32Array.from([e,-i,0,i,e,0,0,0,1])},_=function(t,e){return Float32Array.from([t,0,0,0,e,0,0,0,1])},l=function(t,e){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],n=t[5],h=t[6],_=t[7],l=t[8],c=e[0],u=e[1],g=e[2],d=e[3],p=e[4],f=e[5],m=e[6],v=e[7],A=e[8];return Float32Array.from([c*i+u*s+g*h,c*r+u*a+g*_,c*o+u*n+g*l,d*i+p*s+f*h,d*r+p*a+f*_,d*o+p*n+f*l,m*i+v*s+A*h,m*r+v*a+A*_,m*o+v*n+A*l])},c=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.mult=function(e){return new t(this.x*e,this.y*e)},t}(),u=function(){function t(t,e,i,r,o){void 0===r&&(r=1),void 0===o&&(o=1),this._pos=new c(0,0),this._scale=new c(1,1);var s=t.createVertexArray();t.bindVertexArray(s);var a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-r,o,0,0,r,o,1,0,-r,-o,0,1,r,-o,1,1]),t.STATIC_DRAW),this._pos=new c(t.canvas.width,-t.canvas.height);var n=e.getAttribLocation("pos"),h=e.getAttribLocation("auv");t.vertexAttribPointer(n,2,t.FLOAT,!1,16,0),t.enableVertexAttribArray(n),t.vertexAttribPointer(h,2,t.FLOAT,!1,16,8),t.enableVertexAttribArray(h),t.bindVertexArray(null),t.bindBuffer(t.ARRAY_BUFFER,null),this._vao=s,this._gl=t,this._shader=e,this._texture=i}return t.prototype.set_scale=function(t){this._scale=t},t.prototype.get_pos=function(){return this._pos},t.prototype.set_pos=function(t){this._pos=t},t.prototype.draw=function(){var t=this._texture.use();this._shader.use(),this._shader.setUniform1i(t,"texture");var e=a(this._gl.canvas.clientWidth,this._gl.canvas.clientHeight);e=l(e,n(this._pos.x,this._pos.y)),e=l(e,h(0)),e=l(e,_(this._scale.x,this._scale.y)),this._shader.setMatrix3fv(e,"mvm"),this._gl.bindVertexArray(this._vao),this._gl.drawArrays(this._gl.TRIANGLE_STRIP,0,4)},t}(),g=function(){function t(t,e){var i=this;this.loaded=!1,this.glLoaded=!1;var r=new Image;r.onload=function(){i.loaded=!0},r.src=e,this._image=r,this._gl=t}return t.prototype.glLoad=function(){this.glLoaded=!0,this._texture=this._gl.createTexture(),this._gl.bindTexture(this._gl.TEXTURE_2D,this._texture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,this._image),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.bindTexture(this._gl.TEXTURE_2D,null)},t.prototype.use=function(){return this.glLoaded||this.glLoad(),this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,this._texture),0},t}(),d=new c(0,1e4),p=new c(0,-50),f=function(){function t(t,e,i){var r=this;this._position=new c(0,0),this._velocity=new c(0,0),this._acceleration=new c(0,0),this._sprite=new u(t,e,i,100,100),this._position=this._sprite.get_pos(),this._position.x-=350,document.addEventListener("keydown",(function(t){return r.handleInput(t)}))}return t.prototype.handleInput=function(t){"Space"==t.code&&(this._spacePressed=!0)},t.prototype.update=function(t){this._spacePressed?(this._acceleration=this._acceleration.add(d),this._acceleration.y>=400&&(this._acceleration.y=400),this._spacePressed=!1):(this._acceleration=this._acceleration.add(p),this._acceleration.y<=-150&&(this._acceleration.y=-150)),this._velocity=this._velocity.add(this._acceleration.mult(t)),this._position=this._position.add(this._velocity.mult(t)),this._sprite.set_pos(this._position),console.log(this._acceleration),this._sprite.draw()},t}(),m=["assets/obstacle-1.png"],v=new Map;!function(){var o=document.querySelector("#glCanvas");if(null!=(t=o.getContext("webgl2"))){var a=new s(t,"attribute vec3 pos;attribute vec2 auv;uniform mat3 mvm;varying highp vec2 uv;void main(){gl_Position=vec4(mvm*vec3(pos.xy,1),1);uv=auv;}","varying highp vec2 uv;uniform sampler2D texture;void main(){gl_FragColor=texture2D(texture,uv);}");i=new g(t,"assets/loading.png"),e=new u(t,a,i,640,320),m.forEach((function(e){v[e]=new g(t,e)})),r=new f(t,a,v[m[0]])}else alert("Unable to initialize WebGL")}(),requestAnimationFrame((function s(a){var n=.001*(a-o);if(o=a,t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),i.loaded){var h=!0;v.forEach((function(t){t.loaded?t.glLoaded||t.glLoad():h=!1})),!h||.001*a<=1?e.draw():r.update(n),requestAnimationFrame(s)}else requestAnimationFrame(s)}))}();
